# 메세징 플랫폼(메세지 큐)

RabbitMQ, Redis, Kafka와 같은 기술들을 메세징 플랫폼이라고 한다. 이러한 것들을 메세지 큐 모델이라고도 하며 **Queue**라는 자료구조를 채택해서 메세지를 전달하는 시스템이며, **메세지 지향 미들웨어(MOM)**을 구현한 시스템

### 메세지 지향 미들웨어(MOM)

메세지 지향 미들웨어란 응용 소프트웨어 간의 비동기적 데이터 통신을 위한 소프트웨어로 비동기적으로 프로세스간 데이터를 주고 받는 기능을 위한 시스템이다.

- 장점
    - 메세지의 백업 기능을 유지함으로써 지속성을 제공하며 이 덕분에 송수신 측은 동시에 네트워크 연결을 유지할 필요가 없음(보관)
    - 미들웨어 계층 자신이 직접 메세지 라우팅을 수행하기 때문에, 하나의 메세지를 여러 수신자에게 배포가 가능(라우팅)
    - 송수신 측의 요구에 따라 전달하는 메세지의 변환 가능(변환)

### 메세지 큐

메세지를 발행하고 전달하는 부분을 Producer 라고 하며, 메세지를 받아서 소비하는 부분을 Consumer. 여기에서 메세지 큐는 Producer 와 Consumer 의 메세지 전달 역할을 하는 매개체. 최근의 MSA환경에서 아키텍처의 핵심적인 역할을 수행

- **메세지 브로커 VS 이벤트 브로커**
    - 메세지 브로커
        - 메세지 브로커는 Producer 가 생산한 메세지를 메세지 큐에 저장하고, 저장된 메세지를 Consumer가 가져갈 수 있도록 한다.
        - 메세지 브로커는 Consumer 가 메세지 큐에서 데이터를 가져가게 되면 즉시 또는 짧은 시간 내에 메세지 큐에서 삭제시킨다.
        - EX) RabbitMQ, Redis
    - 이벤트 브로커
        - 이벤트 또는 메시지라고 불리는 정보를 하나만 보관하고 인덱스를 통해 개별 엑세스를 관리
            - 업무상 필요한 시간 동안 이벤트를 관리
            - 메시지 브로커와 다르게 **이벤트가 삭제되지 않는다는 특징** 존재
            - 서비스에세 발생하는 이벤트를 데이터베이스에 저장하듯이 이벤트 브로커의 큐에 저장
        - 이벤트를 저장함으로써 얻는 장점
            - 딱 한번 일어난 이벤트 데이터를 브로커에 저장함으로써 모든 데이터 요소를 한 곳에서만 제어 또는 편집하도록 조작하는 관례에 맞게 동작
            - 장애가 발생했을 때 장애가 일어난 지점부터 재처리 가능
            - 많은 양의 실시간 스트림 데이터를 효과적으로 처리 가능
        - 이벤트를 받아서 처리하면서 이벤트를 삭제하지 않음
        - 손실되면 안되는 요청을 처리할 때 좋음
        - 데이터가 소비되더라도 삭제되지 않는다
        - 기본적으로 이벤트 브로커는 메세지 브로커의 역할을 할 수 있지만, 메세지 브로커는 즉시 데이터 삭제된다는 특징 때문에 이벤트 브로커로의 역할을 수행할 수 없다.
        - EX) Kafka
- 장점
    - **비동기성**: Queue에 넣어두기 때문에 나중에 필요할 때 메세지를 처리할 수 있다.
    - **낮은 결합도**: 애플리케이션과 분리하고, 애플리케이션끼리의 결합도를 낮출 수 있습니다. 이는 곧 MSA의 핵심 특징
    - **탄력성**: 시스템이 예기치 않은 상황 또는 장애에 대응하고 유연하게 대처할 수 있는 능력을 의미하는 것으로 위의 특징인 낮은 결합도로 인해 Producer나 Consumer 중 하나의 시스템이 장애가 발생하더라도 메세지를 발행하거나 소비하는 행위는 정상적으로 수행될 수 있다.
    - **과잉**: 작업을 메세지로 메세지 큐에 넣어두면 일정 장애 기간동안 송신된 메세지는 큐에 남아있어 추후 장애 복구 시 정상적으로 재시도 및 복구 가능
    - **신뢰성**: 송신된 메세지를 안전하고 확실하게 Consumer가 수신할 수 있다.
    - **확장성**: 메시지 큐를 이용한 통신에서 부하가 증가하더라도 메세지 큐에 Producer 와 Consumer를 추가함으로써 비교적 간단하고 쉽게 수평적 확장이 가능하다.
